[gd_scene load_steps=6 format=2]

[ext_resource path="res://src/ui/MySlider.gd" type="Script" id=1]
[ext_resource path="res://assets/theme.tres" type="Theme" id=2]
[ext_resource path="res://src/ui/OptionSwitcher.tscn" type="PackedScene" id=3]
[ext_resource path="res://src/ui/MyButton.gd" type="Script" id=4]

[sub_resource type="GDScript" id=1]
script/source = "extends \"res://src/ui/Screen.gd\"

onready var music_slider := $Panel/VBoxContainer/GridContainer/MusicSlider
onready var sound_slider := $Panel/VBoxContainer/GridContainer/SoundSlider
onready var tank_engine_sounds_field = $Panel/VBoxContainer/GridContainer/TankEngineSoundsOptions
onready var screenshake_field := $Panel/VBoxContainer/GridContainer/ScreenshakeOptions
onready var network_relay_field:= $Panel/VBoxContainer/GridContainer/NetworkRelayOptions

var _is_ready := false

func _ready() -> void:
	music_slider.value = GameSettings.music_volume
	sound_slider.value = GameSettings.sound_volume
	
	tank_engine_sounds_field.add_item(\"Enabled\", true)
	tank_engine_sounds_field.add_item(\"Disabled\", false)
	tank_engine_sounds_field.value = GameSettings.tank_engine_sounds
	
	screenshake_field.add_item(\"Enabled\", true)
	screenshake_field.add_item(\"Disabled\", false)
	screenshake_field.value = GameSettings.use_screenshake
	
	network_relay_field.add_item(\"Auto\", OnlineMatch.NetworkRelay.AUTO)
	network_relay_field.add_item(\"Forced\", OnlineMatch.NetworkRelay.FORCED)
	network_relay_field.add_item(\"Disabled\", OnlineMatch.NetworkRelay.DISABLED)
	network_relay_field.value = GameSettings.use_network_relay
	
	_is_ready = true

func _show_screen(info: Dictionary = {}) -> void:
	music_slider.focus.grab_without_sound()

func _hide_screen() -> void:
	GameSettings.save_settings()

func _on_MusicSlider_value_changed(value: float) -> void:
	if _is_ready:
		Sounds.play(\"Select\")
	GameSettings.music_volume = value

func _on_SoundSlider_value_changed(value: float) -> void:
	if _is_ready:
		Sounds.play(\"Select\")
	GameSettings.sound_volume = value

func _on_TankEngineSoundsOptions_item_selected(value, index) -> void:
	GameSettings.tank_engine_sounds = value

func _on_ScreenshakeOptions_item_selected(value, _index) -> void:
	GameSettings.use_screenshake = value

func _on_NetworkRelayOptions_item_selected(value, _index) -> void:
	GameSettings.use_network_relay = value

func _on_DoneButton_pressed() -> void:
	Sounds.play(\"Select\")
	ui_layer.go_back()

func _unhandled_input(event: InputEvent) -> void:
	if visible and event.is_action_pressed('ui_accept'):
		get_tree().set_input_as_handled()
		_on_DoneButton_pressed()
"

[node name="SettingsScreen" type="Control"]
anchor_right = 1.0
anchor_bottom = 1.0
theme = ExtResource( 2 )
script = SubResource( 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Panel" type="PanelContainer" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="VBoxContainer" type="VBoxContainer" parent="Panel"]
margin_left = 6.93966
margin_top = 5.49302
margin_right = 1273.19
margin_bottom = 713.96
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Label" type="Label" parent="Panel/VBoxContainer"]
margin_right = 1266.0
margin_bottom = 75.0
rect_min_size = Vector2( 0, 75 )
text = "Settings"
align = 1

[node name="GridContainer" type="GridContainer" parent="Panel/VBoxContainer"]
margin_top = 79.0
margin_right = 1266.0
margin_bottom = 639.0
size_flags_vertical = 3
custom_constants/vseparation = 10
columns = 2

[node name="MusicLabel" type="Label" parent="Panel/VBoxContainer/GridContainer"]
margin_right = 762.0
margin_bottom = 51.0
text = "Music"

[node name="MusicSlider" type="HSlider" parent="Panel/VBoxContainer/GridContainer"]
margin_left = 766.0
margin_top = 9.0
margin_right = 1266.0
margin_bottom = 51.0
rect_min_size = Vector2( 500, 0 )
size_flags_vertical = 12
max_value = 1.25
step = 0.05
value = 1.0
script = ExtResource( 1 )

[node name="SoundLabel" type="Label" parent="Panel/VBoxContainer/GridContainer"]
margin_top = 61.0
margin_right = 762.0
margin_bottom = 112.0
text = "Sound"

[node name="SoundSlider" type="HSlider" parent="Panel/VBoxContainer/GridContainer"]
margin_left = 766.0
margin_top = 70.0
margin_right = 1266.0
margin_bottom = 112.0
rect_min_size = Vector2( 500, 0 )
size_flags_vertical = 12
max_value = 1.25
step = 0.05
value = 1.0
script = ExtResource( 1 )

[node name="TankEngineSoundsLabel" type="Label" parent="Panel/VBoxContainer/GridContainer"]
margin_top = 122.0
margin_right = 762.0
margin_bottom = 173.0
text = "Tank engine sounds"

[node name="TankEngineSoundsOptions" parent="Panel/VBoxContainer/GridContainer" instance=ExtResource( 3 )]
anchor_right = 0.0
anchor_bottom = 0.0
margin_left = 766.0
margin_top = 122.0
margin_right = 1266.0
margin_bottom = 173.0

[node name="ScreenshakeLabel" type="Label" parent="Panel/VBoxContainer/GridContainer"]
margin_top = 183.0
margin_right = 762.0
margin_bottom = 234.0
size_flags_horizontal = 3
text = "Screen shake"

[node name="ScreenshakeOptions" parent="Panel/VBoxContainer/GridContainer" instance=ExtResource( 3 )]
anchor_right = 0.0
anchor_bottom = 0.0
margin_left = 766.0
margin_top = 183.0
margin_right = 1266.0
margin_bottom = 234.0

[node name="NetworkRelayLabel" type="Label" parent="Panel/VBoxContainer/GridContainer"]
margin_top = 244.0
margin_right = 762.0
margin_bottom = 295.0
text = "Network relay"

[node name="NetworkRelayOptions" parent="Panel/VBoxContainer/GridContainer" instance=ExtResource( 3 )]
anchor_right = 0.0
anchor_bottom = 0.0
margin_left = 766.0
margin_top = 244.0
margin_right = 1266.0
margin_bottom = 295.0

[node name="DoneButton" type="Button" parent="Panel/VBoxContainer"]
margin_left = 558.0
margin_top = 643.0
margin_right = 708.0
margin_bottom = 708.534
rect_min_size = Vector2( 150, 0 )
size_flags_horizontal = 4
text = "Done"
script = ExtResource( 4 )
[connection signal="value_changed" from="Panel/VBoxContainer/GridContainer/MusicSlider" to="." method="_on_MusicSlider_value_changed"]
[connection signal="value_changed" from="Panel/VBoxContainer/GridContainer/SoundSlider" to="." method="_on_SoundSlider_value_changed"]
[connection signal="item_selected" from="Panel/VBoxContainer/GridContainer/TankEngineSoundsOptions" to="." method="_on_TankEngineSoundsOptions_item_selected"]
[connection signal="item_selected" from="Panel/VBoxContainer/GridContainer/ScreenshakeOptions" to="." method="_on_ScreenshakeOptions_item_selected"]
[connection signal="item_selected" from="Panel/VBoxContainer/GridContainer/NetworkRelayOptions" to="." method="_on_NetworkRelayOptions_item_selected"]
[connection signal="pressed" from="Panel/VBoxContainer/DoneButton" to="." method="_on_DoneButton_pressed"]
